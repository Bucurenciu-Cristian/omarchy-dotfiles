#!/bin/bash
# Project Directory Picker - Browse and select a directory using fzf
# Outputs selected path to stdout or writes to temp file for GUI integration

set -euo pipefail

TEMP_FILE="${1:-}"
SEARCH_PATHS=("$HOME/dev" "$HOME/projects" "$HOME/work" "$HOME")

# Build list of directories from common locations
find_directories() {
    for path in "${SEARCH_PATHS[@]}"; do
        if [[ -d "$path" ]]; then
            fd --type d --max-depth 3 --hidden --exclude .git --exclude node_modules --exclude .cache --exclude __pycache__ . "$path" 2>/dev/null
        fi
    done | sort -u
}

# Run fzf with preview
selected=$(find_directories | fzf \
    --height=100% \
    --layout=reverse \
    --border=rounded \
    --prompt="Select project directory: " \
    --header="Navigate with arrows, type to filter, Enter to select, Esc to cancel" \
    --preview='ls -la --color=always {} 2>/dev/null | head -20' \
    --preview-window=right:40%:wrap \
    --bind='ctrl-h:toggle-preview' \
    || echo "")

if [[ -n "$selected" ]]; then
    if [[ -n "$TEMP_FILE" ]]; then
        echo "$selected" > "$TEMP_FILE"
    else
        echo "$selected"
    fi
fi
